
# 簡易圖書管理功能 - 系統分析書

> 更新日期：2023/1/5  

## 修訂紀錄

| 修訂時間 | 修訂記錄 | 修訂版本 | 修訂者 |
|----------|----------|----------|--------|
| 2023/1/3 | 初版     | 1.0      | XXX |

---

## 目錄

1. [服務資訊](#服務資訊)  
2. [系統規格](#系統規格)  
3. [資料存取](#資料存取)  
4. [附註](#附註)  

---

## 1. 服務資訊

### 1.1 新增書籍

- **URL**: `/book/add`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 新增書籍時，系統自動填入建檔日期為當日；借閱狀態為 1-未借出。

**請求範例**:
```json
{
  "book_ISBN": "9787115488800",
  "book_language": "2",
  "book_name": "Java攻略 Java常見問題的簡單解法",
  "book_author": "",
  "book_publisher": "人民郵電",
  "book_pub_date": "2018-08-01"
}
```

**回應成功**:
```json
{
  "MWHEADER": {
    "RETURNCODE": "0000",
    "RETURNDESC": "交易成功"
  }
}
```

**回應失敗**:
```json
{
  "MWHEADER": {
    "RETURNCODE": "E001",
    "RETURNDESC": "交易失敗, 資料已存在"
  }
}
```

---

### 1.2 修改書籍

- **URL**: `/book/modify`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 修改指定 ISBN 的書籍資料，需包含建檔日期與借閱狀態。

**請求範例**:
```json
{
  "book_ISBN": "9787115488800",
  "book_language": "2",
  "book_name": "Java攻略 Java常見問題的簡單解法",
  "book_author": "",
  "book_publisher": "人民郵電",
  "book_pub_date": "2018-08-01",
  "book_create_date": "2022-12-12",
  "book_status": "3"
}
```

---

### 1.3 刪除書籍

- **URL**: `/book/delete`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 依據 ISBN 刪除書籍資料。

**請求範例**:
```json
{
  "book_ISBN": "9787115488800"
}
```

---

### 1.4 查詢書籍

- **URL**: `/book/query`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 提供 ISBN、借閱狀態或書名模糊查詢三種方式查詢書籍資料。

**查詢方式說明**:

- `query_type`:  
  - 1: 書籍查詢  
  - 2: 借閱狀態查詢  
  - 3: 書名模糊查詢  

**查詢範例 - 書名模糊查詢**:
```json
{
  "query_type": "3",
  "book_name": "JAVA"
}
```

---

### 1.5 借閱書籍

- **URL**: `/book/borrow`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 借閱書籍時需修改借閱狀態並紀錄借閱者與借出日期。

**請求範例**:
```json
{
  "book_ISBN": "9787115488800",
  "book_borrower_ID": "00514956"
}
```

---

### 1.6 歸還書籍

- **URL**: `/book/return`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 歸還書籍時清除借閱者資料與借出日期，並更新借閱狀態為未借出。

**請求範例**:
```json
{
  "book_ISBN": "9787115488800",
  "book_borrower_ID": "00514956"
}
```

---

### 1.7 查詢逾期未歸還

- **URL**: `/book/overdue`  
- **方法**: POST  
- **格式**: `application/json`  
- **服務說明**: 查詢超過指定天數未歸還的借閱紀錄。（借閱天數為 30天，第31天為逾期起算日）。

**請求範例**:
```json
{
  "overdue": 30
}
```

---

## 2. 系統規格

- **服務類型**: RESTful  
- **執行平台**: PaaS  
- **Git/TFS 路徑**: 無

---

## 3. 資料存取

### 資料表：BOOK_INFO

| 欄位名稱           | 型態       | 必要 | 說明           |
|--------------------|------------|------|----------------|
| book_ISBN          | 英數字30位 | ✔    | 國際標準書號   |
| book_language      | 英數字2位  | ✔    | 書本語系       |
| book_name          | 文字200位  | ✔    | 書名           |
| book_author        | 文字200位  |      | 作者           |
| book_publisher     | 文字200位  |      | 出版商         |
| book_pub_date      | 日期       |      | 出版日期       |
| book_create_date   | 日期       | ✔    | 建檔日期       |
| book_status        | 英數字2位  | ✔    | 借閱狀態       |
| book_borrower_ID   | 英數字10位 |      | 借閱者行編     |
| borrow_date        | 日期       |      | 借出日期       |

### 資料表：BORROW_LOG

| 欄位名稱         | 型態       | 必要 | 說明             |
|------------------|------------|------|------------------|
| borrow_serial_no | 整數       | ✔    | 借閱流水編號     |
| borrower_ID      | 英數字10位 | ✔    | 借閱者行編       |
| borrow_book_ISBN | 英數字30位 | ✔    | 書籍 ISBN        |
| borrow_action    | 英數字2位  | ✔    | 動作（1借出/2歸還） |
| action_date      | 日期       |      | 執行日期         |

---

## 4. 附註

### 錯誤代碼表

| 代碼   | 說明                         |
|--------|------------------------------|
| 0000   | 交易成功                     |
| V001   | 缺乏必要輸入欄位：XXX        |
| V002   | 輸入欄位格式錯誤：XXX        |
| E001   | 交易失敗, 失敗原因           |
| E999   | 其他錯誤                     |
